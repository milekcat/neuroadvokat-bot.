import os
import logging
from datetime import datetime
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, ReplyKeyboardMarkup, ReplyKeyboardRemove
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, MessageHandler, filters, ContextTypes

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è ---
logging.basicConfig(format="%(asctime)s - %(name)s - %(levelname)s - %(message)s", level=logging.INFO)
logger = logging.getLogger(__name__)

# --- –ù–ê–°–¢–†–û–ô–ö–ê ---
# –ò—Å–ø–æ–ª—å–∑—É–µ–º .get(), –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–∞–¥–∞–µ—Ç, –∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç None, –µ—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ—Ç
BOT_TOKEN = os.environ.get('BOT_TOKEN')
CHAT_ID_FOR_ALERTS = os.environ.get('CHAT_ID_FOR_ALERTS')
TELEGRAM_CHANNEL_URL = os.environ.get('TELEGRAM_CHANNEL_URL')

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª—é—á–µ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç.
if not BOT_TOKEN or not CHAT_ID_FOR_ALERTS:
    logger.critical("FATAL ERROR: Required environment variable 'BOT_TOKEN' or 'CHAT_ID_FOR_ALERTS' was NOT found.")
    exit(1)

# --- –¢–ï–ö–°–¢–´ –ò –ö–û–ù–°–¢–ê–ù–¢–´ ---
SERVICE_DESCRIPTIONS = {
    "civil": (
        "‚öñÔ∏è **–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–µ –ø—Ä–∞–≤–æ: –ó–∞—â–∏—Ç–∞ –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏**\n\n"
        "–î–ª—è –∫–∞–∂–¥–æ–≥–æ, –∫—Ç–æ —Å—Ç–æ–ª–∫–Ω—É–ª—Å—è —Å –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å—é: –ø—Ä–æ–¥–∞–ª–∏ –±—Ä–∞–∫–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä, –Ω–µ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ —Å–¥–µ–ª–∞–ª–∏ —Ä–µ–º–æ–Ω—Ç, "
        "—Ö–∏–º—á–∏—Å—Ç–∫–∞ –∏—Å–ø–æ—Ä—Ç–∏–ª–∞ –≤–µ—â—å, —Å—Ç—Ä–∞—Ö–æ–≤–∞—è –∑–∞–Ω–∏–∂–∞–µ—Ç –≤—ã–ø–ª–∞—Ç—É –ø–æ –î–¢–ü, —Å–æ—Å–µ–¥–∏ –∑–∞—Ç–æ–ø–∏–ª–∏ –∫–≤–∞—Ä—Ç–∏—Ä—É.\n\n"
        "**–ú—ã –≥–æ—Ç–æ–≤–∏–º:**\n"
        "‚Ä¢ **–ü—Ä–µ—Ç–µ–Ω–∑–∏–∏:** –≥—Ä–∞–º–æ—Ç–Ω—ã–π –¥–æ—Å—É–¥–µ–±–Ω—ã–π —à–∞–≥, –∫–æ—Ç–æ—Ä—ã–π —á–∞—Å—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –±–µ–∑ —Å—É–¥–∞.\n"
        "‚Ä¢ **–ò—Å–∫–æ–≤—ã–µ –∑–∞—è–≤–ª–µ–Ω–∏—è:** –æ –≤–æ–∑–≤—Ä–∞—Ç–µ –¥–µ–Ω–µ–≥, –≤–∑—ã—Å–∫–∞–Ω–∏–∏ –Ω–µ—É—Å—Ç–æ–π–∫–∏, –≤–æ–∑–º–µ—â–µ–Ω–∏–∏ —É—â–µ—Ä–±–∞ –∏ –º–æ—Ä–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–¥–∞.\n"
        "‚Ä¢ **–ó–∞—è–≤–ª–µ–Ω–∏—è –Ω–∞ —Å—É–¥–µ–±–Ω—ã–π –ø—Ä–∏–∫–∞–∑:** –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–∑—ã—Å–∫–∞–Ω–∏—è –±–µ—Å—Å–ø–æ—Ä–Ω—ã—Ö –¥–æ–ª–≥–æ–≤."
    ),
    "family": (
        "üë®‚Äçüë©‚Äçüëß‚Äçüë¶ **–°–µ–º–µ–π–Ω–æ–µ –ø—Ä–∞–≤–æ: –î–µ–ª–∏–∫–∞—Ç–Ω–∞—è –ø–æ–º–æ—â—å**\n\n"
        "–î–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏, –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã.\n\n"
        "**–ú—ã –≥–æ—Ç–æ–≤–∏–º:**\n"
        "‚Ä¢ **–ò—Å–∫–æ–≤—ã–µ –∑–∞—è–≤–ª–µ–Ω–∏—è –æ –≤–∑—ã—Å–∫–∞–Ω–∏–∏ –∞–ª–∏–º–µ–Ω—Ç–æ–≤:** –∫–∞–∫ –≤ % –æ—Ç –¥–æ—Ö–æ–¥–∞, —Ç–∞–∫ –∏ –≤ —Ç–≤–µ—Ä–¥–æ–π –¥–µ–Ω–µ–∂–Ω–æ–π —Å—É–º–º–µ (–µ—Å–ª–∏ –¥–æ—Ö–æ–¥ ¬´—Å–µ—Ä—ã–π¬ª).\n"
        "‚Ä¢ **–ó–∞—è–≤–ª–µ–Ω–∏—è –æ —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–∏ –±—Ä–∞–∫–∞** (–µ—Å–ª–∏ –Ω–µ—Ç —Å–ø–æ—Ä–∞ –æ –¥–µ—Ç—è—Ö –∏ –∏–º—É—â–µ—Å—Ç–≤–µ).\n"
        "‚Ä¢ **–ü—Ä–æ–µ–∫—Ç—ã —Å–æ–≥–ª–∞—à–µ–Ω–∏–π –æ–± —É–ø–ª–∞—Ç–µ –∞–ª–∏–º–µ–Ω—Ç–æ–≤:** –¥–ª—è –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ–≥–æ –Ω–æ—Ç–∞—Ä–∏–∞–ª—å–Ω–æ–≥–æ –∑–∞–≤–µ—Ä–µ–Ω–∏—è."
    ),
    "housing": (
        "üè† **–ñ–∏–ª–∏—â–Ω–æ–µ –ø—Ä–∞–≤–æ: –í–∞—à –¥–æ–º ‚Äî –≤–∞—à–∞ –∫—Ä–µ–ø–æ—Å—Ç—å**\n\n"
        "–î–ª—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ –∏ –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±–æ—Ä—é—Ç—Å—è —Å –±–µ–∑–¥–µ–π—Å—Ç–≤–∏–µ–º –£–ö, —Ä–µ—à–∞—é—Ç —Å–ø–æ—Ä—ã —Å —Å–æ—Å–µ–¥—è–º–∏ –∏–ª–∏ —Ö–æ—Ç—è—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ —Å–¥–µ–ª–∫—É.\n\n"
        "**–ú—ã –≥–æ—Ç–æ–≤–∏–º:**\n"
        "‚Ä¢ **–ñ–∞–ª–æ–±—ã:** –≤ –£–ø—Ä–∞–≤–ª—è—é—â—É—é –∫–æ–º–ø–∞–Ω–∏—é, –ñ–∏–ª–∏—â–Ω—É—é –∏–Ω—Å–ø–µ–∫—Ü–∏—é, –†–æ—Å–ø–æ—Ç—Ä–µ–±–Ω–∞–¥–∑–æ—Ä.\n"
        "‚Ä¢ **–ò—Å–∫–æ–≤—ã–µ –∑–∞—è–≤–ª–µ–Ω–∏—è:** –æ–± –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –ø–æ—Ä—è–¥–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–≤–∞—Ä—Ç–∏—Ä–æ–π, –æ –Ω–µ—á–∏–Ω–µ–Ω–∏–∏ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π.\n"
        "‚Ä¢ **–ü—Ä–æ–µ–∫—Ç—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤:** –∫—É–ø–ª–∏-–ø—Ä–æ–¥–∞–∂–∏, –¥–∞—Ä–µ–Ω–∏—è, –∞—Ä–µ–Ω–¥—ã (–Ω–∞–π–º–∞) —Å —É—á–µ—Ç–æ–º –≤–∞—à–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤."
    ),
    "military": (
        "üõ°Ô∏è **–í–æ–µ–Ω–Ω–æ–µ –ø—Ä–∞–≤–æ –∏ —Å–æ—Ü–æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞—â–∏—Ç–Ω–∏–∫–æ–≤**\n\n"
        "–î–ª—è –≤–æ–µ–Ω–Ω–æ—Å–ª—É–∂–∞—â–∏—Ö (–≤–∫–ª—é—á–∞—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –°–í–û), –≤–µ—Ç–µ—Ä–∞–Ω–æ–≤ –∏ –∏—Ö —Å–µ

        
